#!/usr/bin/env python3
"""
–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è FilterPlugin –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Ñ—Ä–∞–∑–∞–º
"""

import sys
import os
import json
from datetime import datetime

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ src –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –ø–ª–∞–≥–∏–Ω–æ–≤
sys.path.insert(0, os.path.join(os.path.dirname(__file__), 'src'))

from src.plugins.filter.filter_plugin import FilterPlugin


def main():
    """–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è FilterPlugin –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏"""
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞
    filter_plugin = FilterPlugin()
    filter_plugin.initialize()
    
    # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    test_posts = [
        {
            "text": "–î–∞–∂–µ –≤ –±–æ–µ–≤—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö —á–µ–ª–æ–≤–µ–∫ –æ—Å—Ç–∞—ë—Ç—Å—è —á–µ–ª–æ–≤–µ–∫–æ–º. üéØ #–≤–æ–π–Ω–∞",
            "owner_id": 1,
            "id": 100
        },
        {
            "text": "–õ–∏—Å –ø–µ—Ä–µ–¥–∞–µ—Ç –≤—Å–µ–º –¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ! ‚òÄÔ∏è #—É—Ç—Ä–æ",
            "owner_id": 2,
            "id": 200
        },
        {
            "text": "–ü—Ä–∏–≤–µ—Ç —Ä–æ–¥–Ω–æ–π –ë—É—Ä—è—Ç–∏–∏ –æ—Ç —à—Ç—É—Ä–º–æ–≤–∏–∫–æ–≤ —Ç–∞–Ω–∫–æ–≤–æ–π –±—Ä–∏–≥–∞–¥—ã —Å –Æ–∂–Ω–æ-–î–æ–Ω–µ—Ü–∫–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è üá∑üá∫",
            "owner_id": 3,
            "id": 300
        },
        {
            "text": "–û–±—ã—á–Ω—ã–π –ø–æ—Å—Ç –±–µ–∑ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤",
            "owner_id": 4,
            "id": 400
        },
        {
            "text": "–î–∞–∂–µ –≤ –±–æ–µ–≤—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö —á–µ–ª–æ–≤–µ–∫ –æ—Å—Ç–∞—ë—Ç—Å—è —á–µ–ª–æ–≤–µ–∫–æ–º. –î—É–±–ª–∏–∫–∞—Ç",
            "owner_id": 1,
            "id": 100  # –î—É–±–ª–∏–∫–∞—Ç
        }
    ]
    
    print(f"üìä –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: {len(test_posts)} –ø–æ—Å—Ç–æ–≤")
    
    # 1. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤
    print("\nüîç 1. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤:")
    unique_posts = filter_plugin.filter_unique_posts(test_posts)
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {len(unique_posts)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤")
    
    # 2. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É –±–µ–∑ –æ—á–∏—Å—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞
    print("\nüîç 2. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É (–±–µ–∑ –æ—á–∏—Å—Ç–∫–∏):")
    keyword_filtered = filter_plugin.filter_posts_by_keyword(
        unique_posts, 
        "–î–∞–∂–µ –≤ –±–æ–µ–≤—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö", 
        exact_match=True
    )
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {len(keyword_filtered)} –ø–æ—Å—Ç–æ–≤ —Å –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–æ–º")
    
    # 3. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å –æ—á–∏—Å—Ç–∫–æ–π —Ç–µ–∫—Å—Ç–∞
    print("\nüîç 3. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å –æ—á–∏—Å—Ç–∫–æ–π —Ç–µ–∫—Å—Ç–∞:")
    cleaned_filtered = filter_plugin.filter_posts_by_keyword_with_text_cleaning(
        unique_posts,
        "–î–∞–∂–µ –≤ –±–æ–µ–≤—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö —á–µ–ª–æ–≤–µ–∫ –æ—Å—Ç–∞—ë—Ç—Å—è —á–µ–ª–æ–≤–µ–∫–æ–º",
        exact_match=True
    )
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {len(cleaned_filtered)} –ø–æ—Å—Ç–æ–≤ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞")
    
    # 4. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
    print("\nüîç 4. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º:")
    keywords = ["–î–∞–∂–µ –≤ –±–æ–µ–≤—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö", "–õ–∏—Å –ø–µ—Ä–µ–¥–∞–µ—Ç", "–ü—Ä–∏–≤–µ—Ç —Ä–æ–¥–Ω–æ–π"]
    multi_filtered = filter_plugin.filter_posts_by_multiple_keywords(
        unique_posts,
        keywords,
        exact_match=True,
        use_text_cleaning=True
    )
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {len(multi_filtered)} –ø–æ—Å—Ç–æ–≤ –ø–æ {len(keywords)} –∫–ª—é—á–∞–º")
    
    # 5. –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
    print("\nüîç 5. –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è:")
    comprehensive_filtered = filter_plugin.filter_posts_comprehensive(
        posts=test_posts,
        keywords=["–î–∞–∂–µ –≤ –±–æ–µ–≤—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö", "–õ–∏—Å –ø–µ—Ä–µ–¥–∞–µ—Ç"],
        exact_match=True,
        use_text_cleaning=True,
        remove_duplicates=True
    )
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {len(comprehensive_filtered)} –ø–æ—Å—Ç–æ–≤ –ø–æ—Å–ª–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏")
    
    # –í—ã–≤–æ–¥–∏–º –¥–µ—Ç–∞–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    print("\nüìã –î–µ—Ç–∞–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:")
    for i, post in enumerate(comprehensive_filtered, 1):
        print(f"   {i}. owner_id={post['owner_id']}, id={post['id']}")
        print(f"      –¢–µ–∫—Å—Ç: {post['text'][:50]}...")
    
    # 6. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±–µ–∑ –æ—á–∏—Å—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞
    print("\nüîç 6. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±–µ–∑ –æ—á–∏—Å—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞:")
    no_cleaning_filtered = filter_plugin.filter_posts_comprehensive(
        posts=test_posts,
        keywords=["–î–∞–∂–µ –≤ –±–æ–µ–≤—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö —á–µ–ª–æ–≤–µ–∫ –æ—Å—Ç–∞—ë—Ç—Å—è —á–µ–ª–æ–≤–µ–∫–æ–º"],
        exact_match=True,
        use_text_cleaning=False,
        remove_duplicates=True
    )
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {len(no_cleaning_filtered)} –ø–æ—Å—Ç–æ–≤ –±–µ–∑ –æ—á–∏—Å—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞")
    
    # –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø–ª–∞–≥–∏–Ω–∞
    filter_plugin.shutdown()
    
    print(f"\n‚úÖ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è FilterPlugin –∑–∞–≤–µ—Ä—à–µ–Ω!")
    print(f"üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ API, —ç—Ç–æ—Ç –ø–ª–∞–≥–∏–Ω –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞ –ª–æ–∫–∞–ª—å–Ω—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –∫–ª—é—á–µ–≤—ã–º —Ñ—Ä–∞–∑–∞–º.")


if __name__ == "__main__":
    main() 