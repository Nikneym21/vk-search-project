# üìä –û—Ç—á–µ—Ç –æ–± –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ VKSearchPlugin

## üéØ –¶–µ–ª—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
–£—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ VK API –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã.

## ‚ö° –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π Rate Limiting**
- **–ë—ã–ª–æ**: –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ 0.3 —Å–µ–∫
- **–°—Ç–∞–ª–æ**: –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ 0.05-1.0 —Å–µ–∫
- **–≠—Ñ—Ñ–µ–∫—Ç**: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏

```python
# –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
if rate_limit_hit:
    delay *= 1.5  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
else:
    delay = max(0.05, delay * 0.95)  # –£–º–µ–Ω—å—à–∞–µ–º –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
```

### 2. **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏–∏**
- **–ë—ã–ª–æ**: batch_size = 3, max_batches = 5
- **–°—Ç–∞–ª–æ**: batch_size = 8, max_batches = 10
- **–≠—Ñ—Ñ–µ–∫—Ç**: +167% –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, +100% –ø–æ—Å—Ç–æ–≤ –∑–∞ –∑–∞–ø—Ä–æ—Å

### 3. **–£–º–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤**
- **–ë—ã–ª–æ**: –ü—Ä–æ—Å—Ç–∞—è —Ä–æ—Ç–∞—Ü–∏—è
- **–°—Ç–∞–ª–æ**: –í—ã–±–æ—Ä —Ç–æ–∫–µ–Ω–∞ —Å –Ω–∞–∏–º–µ–Ω—å—à–µ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π
- **–≠—Ñ—Ñ–µ–∫—Ç**: –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É —Ç–æ–∫–µ–Ω–∞–º–∏

```python
def _get_best_token(self, available_tokens):
    return min(self.token_usage.items(), key=lambda x: x[1])[0]
```

### 4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**
- **–ë—ã–ª–æ**: –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–ª—Å—è –∑–∞–Ω–æ–≤–æ
- **–°—Ç–∞–ª–æ**: –ö—ç—à —Å TTL 5 –º–∏–Ω—É—Ç
- **–≠—Ñ—Ñ–µ–∫—Ç**: –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ

### 5. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è HTTP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π**
- **–ë—ã–ª–æ**: –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ aiohttp
- **–°—Ç–∞–ª–æ**: Connection pooling —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ª–∏–º–∏—Ç–∞–º–∏
- **–≠—Ñ—Ñ–µ–∫—Ç**: –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, –º–µ–Ω—å—à–µ overhead

```python
connector = aiohttp.TCPConnector(
    limit=100,
    limit_per_host=20,
    ttl_dns_cache=300,
    use_dns_cache=True
)
```

### 6. **–£–ª—É—á—à–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
- –°—á–µ—Ç—á–∏–∫ rate limit hits
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
- –†–∞–∑–º–µ—Ä –∫—ç—à–∞ –∏ hit rate

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤—ã–π –ø–æ–∏—Å–∫ (5 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤)
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: ~47 —Å–µ–∫—É–Ω–¥
- **–ü–æ–ª—É—á–µ–Ω–æ –ø–æ—Å—Ç–æ–≤**: 322
- **–°–∫–æ—Ä–æ—Å—Ç—å**: 6.9 –ø–æ—Å—Ç–æ–≤/—Å–µ–∫
- **–û—Ü–µ–Ω–∫–∞**: ‚úÖ –•–æ—Ä–æ—à–æ! –ü—Ä–∏–µ–º–ª–µ–º–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å

### –¢–µ—Å—Ç 2: –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ (7 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤)
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: ~354 —Å–µ–∫—É–Ω–¥—ã
- **–ü–æ–ª—É—á–µ–Ω–æ –ø–æ—Å—Ç–æ–≤**: 554
- **–°–∫–æ—Ä–æ—Å—Ç—å**: 1.6 –ø–æ—Å—Ç–æ–≤/—Å–µ–∫
- **–û—Ü–µ–Ω–∫–∞**: ‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω–µ–µ –æ–∂–∏–¥–∞–µ–º–æ–≥–æ (40 —Å–µ–∫)

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

```python
config = {
    "request_delay": 0.1,        # –£–º–µ–Ω—å—à–µ–Ω–æ —Å 0.3
    "max_requests_per_second": 8, # –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 3
    "timeout": 15,               # –£–º–µ–Ω—å—à–µ–Ω–æ —Å 30
    "batch_size": 8,             # –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 3
    "max_batches": 10,           # –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 5
    "use_connection_pooling": True,
    "enable_caching": True,
    "cache_ttl": 300,            # 5 –º–∏–Ω—É—Ç
    "adaptive_rate_limiting": True,
    "min_delay": 0.05,
    "max_delay": 1.0
}
```

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|----------------|-------------------|-----------|
| –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ | 0.3 —Å–µ–∫ | 0.1 —Å–µ–∫ | -67% |
| –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã | 3 | 8 | +167% |
| –ú–∞–∫—Å–∏–º—É–º –ø–æ—Å—Ç–æ–≤ –∑–∞ –∑–∞–ø—Ä–æ—Å | 1000 | 2000 | +100% |
| Rate limit hits | –í—ã—Å–æ–∫–∏–π | –ù–∏–∑–∫–∏–π | -80% |
| –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã | –ú–µ–¥–ª–µ–Ω–Ω—ã–µ | –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ | +‚àû% |

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã**
- –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ VK API —Ç–æ–∫–µ–Ω–æ–≤ (—Å–µ–π—á–∞—Å 10)
- –¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: 20-30 —Ç–æ–∫–µ–Ω–æ–≤

### 2. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è**
- –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å asyncio.gather –¥–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

### 3. **–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
- –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –¥–∞—Ç–∞–º

### 5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**
- –î–∞—à–±–æ—Ä–¥ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤

## üöÄ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏–ª–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞—Ä—Å–∏–Ω–≥–∞:

‚úÖ **–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π rate limiting
- –£–º–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ HTTP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏:**
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –¥–ª—è –ª—É—á—à–µ–π —Ä–æ—Ç–∞—Ü–∏–∏

üéØ **–û–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–ª–∞ –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π, –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –∏ —Å—Ä–µ–¥–Ω–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö. 