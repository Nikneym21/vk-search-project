#!/usr/bin/env python3
"""
–¢–µ—Å—Ç —Å—Ç—Ä–æ–≥–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ VK API —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
"""

import asyncio
import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ src –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
sys.path.insert(0, os.path.join(os.path.dirname(__file__), 'src'))

from plugins.vk_search.vk_search_plugin import VKSearchPlugin

def test_strict_filtering():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–≥—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é"""
    plugin = VKSearchPlugin()

    # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ - —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–∏—Å–∫–∞
    test_posts = [
        {
            'text': '–≠–ø–æ—Ö–∞ –ø—É–Ω–∏—á–µ—Å–∫–∏—Ö –≤–æ–π–Ω. –ü–æ–¥—Å—Ç—Ä–µ–∫–∞–µ–º—ã–µ –ö–ª–∞–≤–¥–∏–µ–º –º–∞–º–µ—Ä—Ç–∏–Ω—Ü—ã –∑–∞—Ö–≤–∞—Ç–∏–ª–∏ –≤ –ø–ª–µ–Ω –∫–æ–º–∞–Ω–¥—É—é—â–µ–≥–æ –º–µ—Å—Ç–Ω—ã–º –∫–∞—Ä—Ñ–∞–≥–µ–Ω—Å–∫–∏–º –≥–∞—Ä–Ω–∏–∑–æ–Ω–æ–º...',
            'link': 'https://vk.com/wall-216074633_3068'
        },
        {
            'text': '#–ù–æ–≤–æ—Å—Ç–∏. –í—Å–µ, –∫—Ç–æ –Ω–∞—Ö–æ–¥–∏–ª–∏—Å—å –Ω–∞ –±–æ—Ä—Ç—É –ê–Ω-24, —Ä–∞–∑–±–∏–≤—à–µ–≥–æ—Å—è –ø–æ–¥ –¢—ã–Ω–¥–æ–π, –ø–æ–≥–∏–±–ª–∏...',
            'link': 'https://vk.com/wall-123456_001'
        },
        {
            'text': '–ù–∞—Å –Ω–µ —Å–ª–æ–º–∏—Ç—å. –ù–∏ –ø–µ–ø–ª–æ–º, –Ω–∏ —Ä–∞–∑—Ä—É—Ö–æ–π. –ê –º—è–≥–∫–∏–π –º–∏—à–∫–∞ ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ, —á—Ç–æ –ø–æ–±–µ–¥–∞ –Ω—É–∂–Ω–∞ —Ä–∞–¥–∏ –±—É–¥—É—â–µ–≥–æ.',
            'link': 'https://vk.com/wall-789012_003'
        },
        {
            'text': '–ü–∞–º—è—Ç–∏ –ø–∞–≤—à–∏—Ö, –≤–æ –∏–º—è –∂–∏–≤—ã—Ö!!! –ú–∏—Ñ –∏–ª–∏ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –ß–µ—á–µ–Ω—Å–∫–æ–π –≤–æ–π–Ω—ã? –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π —Å–Ω–∞–π–ø–µ—Ä –í–æ–ª–æ–¥—è-–Ø–∫—É—Ç...',
            'link': 'https://vk.com/wall-345678_004'
        },
        {
            'text': '–î–æ–±—Ä–æ –≤—Å–µ–≥–¥–∞ –Ω–∞–π–¥—ë—Ç —Å–µ–±–µ –º–µ—Å—Ç–æ ‚Äî –¥–∞–∂–µ –Ω–∞ –ø–µ—Ä–µ–¥–æ–≤–æ–π. –°–æ–ª–¥–∞—Ç—ã –ø–æ–º–æ–≥–∞—é—Ç –º–∏—Ä–Ω—ã–º –∂–∏—Ç–µ–ª—è–º.',
            'link': 'https://vk.com/wall-567890_005'
        }
    ]

    # –¢–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
    keywords = [
        "–ù–∞—Å –Ω–µ —Å–ª–æ–º–∏—Ç—å. –ù–∏ –ø–µ–ø–ª–æ–º, –Ω–∏ —Ä–∞–∑—Ä—É—Ö–æ–π.",
        "–î–æ–±—Ä–æ –≤—Å–µ–≥–¥–∞ –Ω–∞–π–¥—ë—Ç —Å–µ–±–µ –º–µ—Å—Ç–æ ‚Äî –¥–∞–∂–µ –Ω–∞ –ø–µ—Ä–µ–¥–æ–≤–æ–π.",
        "–õ–∏—Å –ø–µ—Ä–µ–¥–∞–µ—Ç –≤—Å–µ–º –¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ"
    ]

    print("üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–≥–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏...")
    print(f"–ò—Å—Ö–æ–¥–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ–≤: {len(test_posts)}")
    print(f"–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: {keywords}")
    print()

    # –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–æ–≥—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
    filtered_posts = plugin._strict_local_filter(test_posts, keywords, exact_match=True)

    print(f"–ü–æ—Å–ª–µ —Å—Ç—Ä–æ–≥–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: {len(filtered_posts)} –ø–æ—Å—Ç–æ–≤")
    print()

    for i, post in enumerate(filtered_posts, 1):
        print(f"–ü–æ—Å—Ç {i}:")
        print(f"  –¢–µ–∫—Å—Ç: {post['text'][:100]}...")
        print(f"  –°–æ–≤–ø–∞–¥–µ–Ω–∏—è: {post.get('keywords_matched', [])}")
        print()

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∂–∏–¥–∞–µ–º—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    expected_count = 2  # –î–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏ –ø–æ—Å—Ç—ã 3 –∏ 5
    if len(filtered_posts) == expected_count:
        print("‚úÖ –¢–µ—Å—Ç –ü–†–û–ô–î–ï–ù: —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
    else:
        print(f"‚ùå –¢–µ—Å—Ç –ü–†–û–í–ê–õ–ï–ù: –æ–∂–∏–¥–∞–ª–æ—Å—å {expected_count}, –ø–æ–ª—É—á–µ–Ω–æ {len(filtered_posts)}")

    return filtered_posts

if __name__ == "__main__":
    test_strict_filtering()
